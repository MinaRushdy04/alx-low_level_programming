god bless nested loops and functions.
